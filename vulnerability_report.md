# 脆弱性診断レポート (VulnBoard)

本レポートは、`VulnBoard` アプリケーションに対して実施した脆弱性診断の結果をまとめたものです。
診断の結果、**極めて危険度の高い脆弱性**が複数確認されました。

## 概要

| 項目 | 内容 |
| :--- | :--- |
| **対象システム** | VulnBoard (Localhost) |
| **診断日** | 2025-12-10 |
| **診断項目** | Webアプリケーション脆弱性診断 (XSS, 認証, 認可, etc) |
| **総合評価** | **危険 (Critical)** |

## 検出された脆弱性一覧

| ID | 脆弱性名 | 危険度 | 概要 |
| :--- | :--- | :--- | :--- |
| 1 | **格納型クロスサイトスクリプティング (Stored XSS)** | ★★★ (高) | スレッドのタイトルや内容にスクリプトを埋め込むことが可能。 |
| 2 | **DOMベース クロスサイトスクリプティング (DOM XSS)** | ★★★ (高) | URLのフラグメント（ハッシュ）を利用してスクリプトを実行可能。 |
| 3 | **認証回避・セッション改ざん** | ★★★★ (最高) | クライアント側のデータを書き換えることで任意のユーザー（管理者含む）になりすましが可能。 |
| 4 | **認可不備 (管理者機能への不正アクセス)** | ★★★★ (最高) | 管理者権限のチェックがクライアント側のみで行われているため、制限を回避可能。 |
| 5 | **機密情報の不適切な保存** | ★★☆ (中) | パスワードが平文で `localStorage` に保存されている。 |

---

## 詳細と実証 (Proof of Concept)

### 1. 格納型クロスサイトスクリプティング (Stored XSS)
**詳細:**
スレッドのタイトル、本文、返信内容を表示する際、`innerHTML` を使用しており、エスケープ処理が行われていません。これにより、悪意のあるスクリプトを永続的に保存・実行させることができます。

**実証:**
タイトルに以下のペイロードを含むスレッドを作成したところ、スレッド一覧画面でスクリプトが実行され、背景色が赤色に変化しました。
```html
<script>document.body.style.backgroundColor='red';</script>XSS Test
```

**対策:**
画面表示時に `innerText` または `textContent` を使用するか、適切なエスケープ処理を行うライブラリを使用してください。

### 2. DOMベース クロスサイトスクリプティング (DOM XSS)
**詳細:**
`thread.html` において、URLのハッシュ値 (`location.hash`) を取得し、デコードしてそのまま `debug-output` 要素の `innerHTML` に代入しています。

**実証:**
以下のURLにアクセスすることで、任意のJavaScriptを実行可能です。
`http://localhost:8080/thread.html#<img src=x onerror=document.body.style.backgroundColor='blue'>`

**対策:**
ユーザーからの入力をそのままHTMLとして解釈させないようにしてください。デバッグ用のコードであれば削除すべきです。

### 3. & 4. 認証・認可回避 (Authentication & Authorization Bypass)
**詳細:**
`Auth.js` および `admin.html` において、認証状態や管理者権限のチェックがすべてクライアント側（JavaScript と `localStorage`）のみで行われています。
攻撃者はブラウザの開発者ツール等を使用して `localStorage` の `vulnboard_session` 値を書き換えることで、管理者権限を取得できます。

**実証:**
`localStorage` のセッション情報を以下のように書き換えることで、管理者として振る舞い、管理画面へのアクセスおよびスレッドの削除に成功しました。
```javascript
localStorage.setItem('vulnboard_session', JSON.stringify({
    "userId": "attacker",
    "username": "attacker",
    "isAdmin": true, // ここを true に変更
    "loginTime": Date.now()
}));
```

**対策:**
認証・認可のロジックは必ず**サーバーサイド**で実装・検証してください。クライアント側のチェックはUXのためだけに使用し、セキュリティ対策としては信頼しないでください。

### 5. パスワードの平文保存
**詳細:**
ユーザー登録時、パスワードが平文（Plaintext）のまま `localStorage` に保存されています。XSS等で `localStorage` が読み取られた場合、全ユーザーのパスワードが漏洩します。

**対策:**
パスワードはハッシュ化（ソルト付き）して保存する必要があります（本来はサーバーサイドで管理すべきです）。

---

## 結論
本アプリケーションはセキュリティ検証用（VulnBoard）の名前の通り、基本的な脆弱性が多数含まれており、実運用に耐えうる状態ではありません。
特に、**サーバーサイドでの検証が一切行われていない** 点が根本的な問題です。実運用にはバックエンドサーバーの実装が不可欠です。